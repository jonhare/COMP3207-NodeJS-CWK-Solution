doctype html
html(lang="en")
	head
		title COMP3207 :: ECS-MUD
		script(type='text/javascript', src='http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js')
		script(type='text/javascript', src='http://terminal.jcubic.pl/js/jquery.terminal-0.8.8.min.js')
		script(type='text/javascript', src='//cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.11/jquery.mousewheel.min.js')
		script(type='text/javascript').
			function init() {
				if (!("WebSocket" in window)) {
					$('#terminal').fadeOut("fast");
					$('<p>You need a browser that supports WebSockets.').appendTo('#container');
				} else {
					var ws;

					var term = $('#terminal').terminal(function(command, term) {
						if (ws) ws.send(command);
					}, {
						name: 'ECS-MUD',
						greetings: '',
						prompt: ''	,
						width: 800,
						height: 340
					});

					term.echo("Disconnected.");
					term.pause();

					$('#connect').on('click', function() {
						if (ws) {
							term.clear();
							term.echo('Disconnected.');
							term.pause();
							$('#connect').html('Connect');
							ws.close();
							ws = undefined;
						} else {
							term.clear();
							$('#connect').html('Disconnect');
							ws = new WebSocket('ws://' + window.location.host + '/ws');
							ws.onmessage = function(msg) {
								term.echo(msg.data);
							};

							term.resume();
							term.focus(true);
						}
					});
				}
			}

			$(init);

		link(rel='stylesheet', href='http://fonts.googleapis.com/css?family=Courier+New')
		link(rel='stylesheet', href='http://terminal.jcubic.pl/css/jquery.terminal.css')
		style.
			body {
				font-family: "monospace";
				background: #333333; 
			}
			h1 {
				font-family: "Courier New"; 
				font-size: 22px; 
				color: #669999; 
				text-align: center;
			}
			#terminal {
				font-family: "Courier New";
				margin-left: auto;
				margin-right: auto;
			}
			.terminal, .cmd {
				background-color: #333333;
				color: #669999;
				font-size: 16px;
			}
	body
		div#wrapper
			div#container
				h1 COMP3207 :: ECS-MUD
				div#terminal
				button#connect Connect